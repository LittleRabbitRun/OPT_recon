# CMakeFiles.txt for the ctsim package
#
# Vladimir S. FONOV - vladimir.fonov@gmail.com

PROJECT(ctsim)

SET(CTSIM_PACKAGE_VERSION_MAJOR 5)
SET(CTSIM_PACKAGE_VERSION_MINOR 2)
SET(CTSIM_PACKAGE_VERSION_PATCH 0)
SET(PACKAGE "ctsim")
SET(PACKAGE_BUGREPORT "ctsim-users@b9.com")

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)


# package stuff
SET(CPACK_GENERATOR TGZ)
SET(CPACK_PACKAGE_VERSION_MAJOR ${CTSIM_PACKAGE_VERSION_MAJOR})
SET(CPACK_PACKAGE_VERSION_MINOR ${CTSIM_PACKAGE_VERSION_MINOR})
SET(CPACK_PACKAGE_VERSION_PATCH ${CTSIM_PACKAGE_VERSION_PATCH})

INCLUDE(CPack)


SET(CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake-modules")

# required packages
FIND_PACKAGE(FFTW3 REQUIRED)
FIND_PACKAGE(PNG QUIET)
FIND_PACKAGE(CTN_DICOM QUIET)
#todo add more here


# convenience variable
IF(PNG_FOUND)
  SET(HAVE_PNG ON)
ELSE(PNG_FOUND)
  SET(HAVE_PNG OFF)
ENDIF(PNG_FOUND)

IF(FFTW3_FOUND)
  SET(FFTW3_PNG ON)
ELSE(FFTW3_FOUND)
  SET(FFTW3_PNG OFF)
ENDIF(FFTW3_FOUND)

IF(CTN_DICOM_FOUND)
  SET(CTN_DICOM_PNG ON)
ELSE(CTN_DICOM_FOUND)
  SET(CTN_DICOM_PNG OFF)
ENDIF(CTN_DICOM_FOUND)

# check sizes of types
INCLUDE (CheckTypeSize)
CHECK_TYPE_SIZE(short SIZEOF_SHORT)
CHECK_TYPE_SIZE(int SIZEOF_INT)
CHECK_TYPE_SIZE(long SIZEOF_LONG)
CHECK_TYPE_SIZE(float SIZEOF_FLOAT)
CHECK_TYPE_SIZE(double SIZEOF_DOUBLE)


# check existence of headers
INCLUDE(CheckIncludeFiles)
CHECK_INCLUDE_FILES(float.h     HAVE_FLOAT_H)
CHECK_INCLUDE_FILES(sys/dir.h   HAVE_SYS_DIR_H)
CHECK_INCLUDE_FILES(sys/ndir.h  HAVE_SYS_NDIR_H)
CHECK_INCLUDE_FILES(sys/time.h  HAVE_SYS_TIME_H)
CHECK_INCLUDE_FILES(sys/types.h HAVE_SYS_TYPES_H)
CHECK_INCLUDE_FILES(sys/wait.h  HAVE_SYS_WAIT_H)
CHECK_INCLUDE_FILES(values.h    HAVE_VALUES_H)
CHECK_INCLUDE_FILES(unistd.h    HAVE_UNISTD_H)
CHECK_INCLUDE_FILES(dirent.h    HAVE_DIRENT_H)
CHECK_INCLUDE_FILES(memory.h    HAVE_MEMORY_H)
CHECK_INCLUDE_FILES(stdlib.h    HAVE_STDLIB_H)
CHECK_INCLUDE_FILES(fcntl.h     HAVE_FCNTL_H)
CHECK_INCLUDE_FILES(dlfcn.h     HAVE_DLFCN_H)
CHECK_INCLUDE_FILES(vfork.h     HAVE_VFORK_H)
CHECK_INCLUDE_FILES(inttypes.h  HAVE_INTTYPES_H)
CHECK_INCLUDE_FILES(string.h    HAVE_STRING_H)
CHECK_INCLUDE_FILES(strings.h   HAVE_STRINGS_H)
CHECK_INCLUDE_FILES(sstram      HAVE_SSTREAM)
CHECK_INCLUDE_FILES(getopt.h    HAVE_GETOPT_H)
CHECK_INCLUDE_FILES(readline.h  HAVE_READLINE_H)
CHECK_INCLUDE_FILES(readline/readline.h  HAVE_READLINE_READLINE_H)
#TODO add checks for other include headers


# check existence of functions
INCLUDE(CheckFunctionExists)
CHECK_FUNCTION_EXISTS(strtod     HAVE_STRTOD)
CHECK_FUNCTION_EXISTS(vprintf    HAVE_VPRINTF)
CHECK_FUNCTION_EXISTS(vsprintf   HAVE_VSPRINTF)
CHECK_FUNCTION_EXISTS(vsnprintf  HAVE_VSNPRINTF)
CHECK_FUNCTION_EXISTS(getopt_long HAVE_GETOPT_LONG)

#TODO add checks for other functions


# a hack to force readline to be found
IF(HAVE_READLINE_H OR HAVE_READLINE_READLINE_H)
  SET(HAVE_READLINE ON)
ENDIF(HAVE_READLINE_H OR HAVE_READLINE_READLINE_H)


# create config.h
CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config.h @ONLY)
ADD_DEFINITIONS(-DHAVE_CONFIG_H)

#configure include directories
INCLUDE_DIRECTORIES(include ${CMAKE_CURRENT_BINARY_DIR}) # config.h is here


#subprojects

IF(NOT HAVE_GETOPT_H)
  #use bundled getopt
  INCLUDE_DIRECTORIES(getopt)
  ADD_SUBDIRECTORY(getopt)
  # link binaries with compled library
  LINK_LIBRARIES(getopt)
ENDIF(NOT HAVE_GETOPT_H)

ADD_SUBDIRECTORY(libctsupport)
ADD_SUBDIRECTORY(libctsim)
ADD_SUBDIRECTORY(tools)

#TODO: add remaining subdirectories
